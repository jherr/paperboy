// Generated by CoffeeScript 1.4.0
(function() {
  var HOST, jserv;

  HOST = 'jack-herrington.vm.lithium.com:8080';

  this.NLPService = (function() {

    function NLPService() {
      var _this = this;
      this.running = {};
      window.setTimeout(function() {
        return _this.update();
      }, 200);
    }

    NLPService.prototype.update = function() {
      var key,
        _this = this;
      for (key in this.running) {
        this.status(key, function(data) {
          if (data.status === 'complete') {
            return _this.get(key, function(data) {
              _this.running[key]({
                status: 'complete',
                result: data
              });
              return delete _this.running[key];
            });
          } else {
            return _this.running[key](data);
          }
        });
      }
      return window.setTimeout(function() {
        return _this.update();
      }, 200);
    };

    NLPService.prototype.process = function(text, callback, customer) {
      var _this = this;
      if (customer == null) {
        customer = 1;
      }
      return $.ajax({
        url: "http://" + HOST + "/api/v1/jobs/start",
        type: 'POST',
        data: {
          customer: customer,
          type: 'SINGLE',
          text: text,
          extra: null
        },
        success: function(data) {
          return _this.running[data.jobid] = callback;
        }
      });
    };

    NLPService.prototype.status = function(job_id, callback) {
      var _this = this;
      return $.ajax({
        url: "http://" + HOST + "/api/v1/jobs/status/" + job_id,
        type: 'GET',
        success: function(data) {
          return callback(data);
        }
      });
    };

    NLPService.prototype.get = function(job_id, callback) {
      var _this = this;
      return $.ajax({
        url: "http://" + HOST + "/api/v1/jobs/get/" + job_id,
        type: 'GET',
        success: function(data) {
          return callback(data);
        }
      });
    };

    return NLPService;

  })();

  jserv = new this.NLPService();

  jserv.process('My job rocks!', function(data) {
    return console.log(data.result);
  });

}).call(this);
